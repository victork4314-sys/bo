# BioSpeak_Release — Unified Bio Speak Platform

BioSpeak_Release consolidates every Bio Speak branch into a single repository
that ships the browser studio, PyQt6 desktop app, natural-language CLI, and the
installer toolchain together. The shared bioinformatics logic lives in
`biospeak_core`, compiled for local Python as well as Pyodide so every edition
behaves identically. A cross-platform design system keeps the interface friendly
and Apple-like while exposing the complete laboratory toolkit.

## Automated Release Pipeline

The GitHub Actions workflow at `.github/workflows/release.yml` builds all four
targets (Windows `.exe`, macOS `.dmg`, Linux `.AppImage`, and the offline web
bundle), pulls the outputs into a `/Release` directory via
`release/create_release_bundle.py`, writes the multi-platform
`Open_BioSpeak` launcher, zips everything as `BioSpeak_All.zip`, and publishes it
to the latest GitHub release. The final job prints the direct download URL so
beginners have a single button to press after downloading the bundle.

## Project Layout

```
/BioSpeak_Full/
  biospeak_core/       shared Bio Speak engine used by every interface
  cli/                 command-line REPL and script runner
  gui/                 PyQt6 desktop studio mirroring the browser workflows
  web/                 Vue + Plotly single-page experience with Pyodide bridge
  installer/           cross-platform installer assets and welcome launcher
  release/             automation scripts for assembling the combined bundle
  examples/            ready-to-run Bio Speak scripts for demonstrations
  dist/                output directory for executables and offline web bundle
  build_web.sh         Linux/macOS offline web bundler
  build_web.bat        Windows offline web bundler
  build_installer.sh   macOS/Linux installer generator
  build_installer.bat  Windows installer generator
  requirements.txt     shared dependency list for builders and integrations
  README.md            full documentation (this file)
```

### Manual bundle assembly

After building the Windows, macOS, and Linux binaries plus the offline web
bundle, run:

```
python release/create_release_bundle.py \
  --windows path/to/BioSpeak.exe \
  --mac path/to/BioSpeak.app \
  --linux path/to/BioSpeak.AppImage \
  --web dist
```

The script writes a fresh `dist/` directory containing the platform executables,
the offline web build, the autogenerated `Open_BioSpeak` launcher (plus a `.bat`
variant for Windows), and `release.json` metadata. When the optional `--no-zip`
flag is omitted the command also creates a `BioSpeak_Full.zip` archive beside
the project directory, delivering a single download that runs offline.

* **biospeak_core/** contains the Bio Speak command engine, alignment routines,
  FASTA/FASTQ/GenBank/GFF/VCF/BAM parsers, tabular analytics, plotting helpers,
  and the `web_api` bridge used by the SPA.
* **cli/** exposes the `biospeak` terminal application with REPL, script runner,
  and verification helpers.
* **gui/** delivers the Apple-inspired PyQt6 desktop studio that invokes the
  same verbs as the browser client.
* **web/** presents the rounded macOS-inspired UI with Vue 3, Plotly, and the
  Pyodide runtime loader. Drag files in, trigger verbs from the toolbar, and see
  synchronized results in the same workspace snapshot the Python engine uses.
* **installer/** contains the Tkinter-based welcome center, the cross-platform
  setup wizard, NSIS configuration, and AppImage resources used to ship
  ready-to-run packages.
* **build scripts** fetch Pyodide, copy the core package, generate a file-map
  report, and leave a `/dist` folder that can be zipped and opened offline in
  any standards-compliant browser.

## Detailed Build & Compilation Instructions

Every platform follows the same high-level flow: prepare a clean Python
environment, install the shared dependencies, verify the toolchain, and then run
the build scripts for the editions you need. The steps below assume
Python 3.10 or newer is available on your `PATH`.

### Common preparation

1. Clone the repository and enter it:
   ```bash
   git clone https://github.com/your-org/BioSpeak_Release
   cd BioSpeak_Release
   ```
2. Create and activate a virtual environment.
   * **Windows (PowerShell)**
     ```pwsh
     py -3 -m venv .venv
     .\.venv\Scripts\Activate.ps1
     ```
   * **macOS / Linux (bash or zsh)**
     ```bash
     python3 -m venv .venv
     source .venv/bin/activate
     ```
3. Install the shared Python requirements:
   ```bash
   python -m pip install --upgrade pip
   python -m pip install -r requirements.txt
   ```
   The requirements file lists PyQt6, BioPython, scikit-bio, pandas, numpy,
   matplotlib, plotly, PyInstaller, and the other libraries referenced by
   `biospeak_core` and the automation scripts. Optional extras such as
   TensorFlow can be installed afterwards if you plan to exercise those
   integrations.
4. Run the built-in verification command to confirm the environment is healthy:
   ```bash
   python cli/biospeak_cli.py verify
   ```

With the environment configured, follow the platform-specific compilation
instructions below.

### Windows build

1. Install the **Microsoft Visual C++ Build Tools** (part of the free “Build
   Tools for Visual Studio”) so PyInstaller can compile binary dependencies.
2. Build the offline web bundle:
   ```cmd
   build_web.bat
   ```
3. Create the PyInstaller executables and NSIS installer:
   ```cmd
   build_installer.bat
   ```
4. (Optional) Assemble the unified release bundle:
   ```cmd
   python release\create_release_bundle.py ^
     --windows dist\BioSpeakInstaller.exe ^
     --mac path\to\BioSpeakInstaller.dmg ^
     --linux path\to\BioSpeak.AppImage ^
     --web dist
   ```
5. The compiled outputs appear in `dist\` (`biospeak.exe`,
   `BioSpeak.exe`, the offline web directory, and `BioSpeakInstaller.exe`).

### macOS build

1. Install the **Xcode Command Line Tools** to provide the compilers required by
   PyInstaller and create-dmg:
   ```bash
   xcode-select --install
   ```
2. Build the offline web bundle:
   ```bash
   ./build_web.sh
   ```
3. Generate the PyInstaller binaries and DMG installer:
   ```bash
   ./build_installer.sh
   ```
4. (Optional) Assemble the release directory:
   ```bash
   python release/create_release_bundle.py \
     --windows path/to/BioSpeakInstaller.exe \
     --mac dist/BioSpeakInstaller.dmg \
     --linux path/to/BioSpeak.AppImage \
     --web dist
   ```
5. `dist/` now holds `BioSpeak.app`, the command-line launcher, the
   offline web bundle, and `BioSpeakInstaller.dmg` for distribution.

### Linux build

1. Install the system packages PyInstaller and AppImage tooling rely on. On
   Debian/Ubuntu:
   ```bash
   sudo apt-get update
   sudo apt-get install build-essential python3-dev patchelf libfuse2
   ```
2. Build the offline web bundle:
   ```bash
   ./build_web.sh
   ```
3. Produce the PyInstaller binaries and AppImage installer:
   ```bash
   ./build_installer.sh
   ```
4. (Optional) Assemble the release directory:
   ```bash
   python release/create_release_bundle.py \
     --windows path/to/BioSpeakInstaller.exe \
     --mac path/to/BioSpeakInstaller.dmg \
     --linux dist/BioSpeak.AppImage \
     --web dist
   ```
5. `dist/` contains the CLI executable, the desktop application, the offline
   web bundle, and `BioSpeak.AppImage`.

These instructions mirror the automated GitHub Actions workflow so local builds
match the release artifacts published by CI.

## Terminal and Desktop Editions

The classic Bio Speak experience remains available without a browser.

### Command-line interface

```
python cli/biospeak_cli.py repl
python cli/biospeak_cli.py run examples/demo.bio
python cli/biospeak_cli.py verify
```

The CLI reads `.bio` scripts line by line, mirrors the natural-language verbs,
and shares the same workspace model as the graphical interfaces.

### PyQt6 desktop studio

```
python gui/biospeak_studio.py
```

The desktop window mirrors the Apple-style layout: top toolbar, sequence
sidebar, tabbed workspace, and live log bar. Sequence selections feed every
analysis, translation, alignment, and export action via `biospeak_core`.

## Building the Web Edition

### Linux or macOS

```
./build_web.sh
```

### Windows

```
build_web.bat
```

Both scripts perform the same sequence:

1. Compile the Python sources to confirm syntax.
2. Generate `dist/file-map.json` with a recursive inventory for auditing.
3. Copy `/web` and `/core` into `dist/`.
4. Download the requested Pyodide release (defaults to 0.24.1) and place it in
   `dist/pyodide/` so the app runs offline after the first build.
5. Print `Build complete — web version operational` to signal success.

Set `PYODIDE_VERSION` before running either script to lock to a specific
release.

## Using Bio Speak Studio (Web)

Open `dist/index.html` in any modern browser. The app keeps everything client
side—no server required.

* **Dropdown menus**: Files (Load, Reset, Export), Sequence (Analyze, Transcribe
  to RNA, Translate, Translate Frames, Reverse Complement, Reverse, Complement,
  GC %, Codon Usage, Motif Search, Split, Slice, Merge, ORF Scan), Align
  (Pairwise Global, Pairwise Local, Compare, Multiple Align).
* **Drag-and-drop loader**: FASTA/FASTQ/GenBank/GFF/VCF/BAM/CSV/TSV/JSON files
  are written into the in-browser filesystem and parsed by the Python engine.
* **Sequence panel**: Rounded cards with checkboxes for selecting sequences.
* **Alignment panel**: Click any result to preview the color-coded alignment.
* **Workspace cards**: Activity log, textual previews, GC% bars, and length
  histograms rendered by Plotly.
* **Export**: Saves the entire workspace (sequences, tables, alignments,
  reports) as a JSON snapshot you can reload later.

Everything the interface does flows through `biospeak_core`—all verbs are the
same ones used in the classic CLI, ensuring identical outputs across platforms.

## Core Capabilities

Bio Speak retains the full natural-language command set:

* **Loading**: `load dna file PATH as NAME`, `load fastq file PATH as NAME`,
  `load genbank file PATH as NAME`, `load gff file PATH as NAME`, `load vcf file
  PATH as NAME`, `load bam file PATH as NAME`, `load table file PATH as NAME`,
  `load json file PATH as NAME`.
* **Sequencing verbs**: `count gc of NAME`, `count bases of NAME`, `count
  codons of NAME`, `find motif MOTIF in NAME`, `slice NAME from START to END as
  NEW`, `split NAME every LENGTH as BASE`, `join FIRST with SECOND as NEW`,
  `reverse complement NAME as NEW`, `transcribe NAME as NEW`, `translate NAME
  as NEW`, `translate frames of NAME as NEW`, `scan orf of NAME minimum LENGTH
  as BASE`.
* **Alignment**: `align FIRST with SECOND as NAME using global|local`,
  `compare FIRST with SECOND`, `align group NAME1 NAME2 ... as NAME using
  mafft|clustal` (delegates to the integration registry when tools are
  available).
* **Reporting**: `make report for NAME as REPORT`, `write report of NAME to
  file PATH`, `export sequences to PATH`, `export table TABLE to PATH`.
* **Inventory**: `list data`, `list sequences`, `list tables`, `show NAME`,
  `describe NAME`, `make file map`.

The SPA issues these commands through the `web_api` helpers so every action stays
in sync with the Python workspace.

## Self Verification

The build scripts already run the Python compiler and emit `file-map.json`. To
manually inspect the project tree, run:

```
python - <<'PY'
from pathlib import Path
from biospeak_core.filemap import generate_file_map
print(generate_file_map(Path('.')))
PY
```

When the bundler prints **“Build complete — web version operational”** the web
edition is ready to ship and runs the full Bio Speak feature set offline.

## Building one-file installers

Bio Speak now ships as a single installer per platform. Each builder assembles
the CLI, desktop studio, Pyodide web bundle, and launcher experience so beginners
only click **Next → Finish**.

### Windows

```
build_installer.bat
```

The script performs the following:

1. Compiles the Python sources and runs the CLI self-tests.
2. Builds the offline web bundle via `build_web.bat`.
3. Uses PyInstaller to create `biospeak.exe`, `BioSpeak`, and the
   Tkinter-based welcome window.
4. Copies the payload into `build/windows/payload` alongside examples and core
   modules.
5. Invokes NSIS (`installer/windows_installer.nsi`) to emit
   `dist/BioSpeakInstaller.exe`.

The NSIS wizard copies files to `Program Files\Bio Speak`, registers desktop and
Start-menu shortcuts, and finishes by launching the welcome selector so users
open the browser, desktop, or terminal editions immediately.

### macOS

```
./build_installer.sh
```

On macOS the script builds universal PyInstaller binaries, stages the payload,
embeds it inside the setup wizard app, and uses `create-dmg` to output
`dist/BioSpeakInstaller.dmg`. The DMG contains `BioSpeakInstaller.app`, which
presents the Tkinter wizard, copies the payload into the chosen Applications
folder, registers shortcuts, and opens the welcome launcher.

### Linux

```
./build_installer.sh
```

When executed on Linux the same script produces the PyInstaller binaries and
wraps them into an AppImage using `appimagetool`. The result is
`dist/BioSpeak.AppImage`, a single file that mounts itself, runs the
wizard, installs into `~/BioSpeak`, adds a desktop entry, and launches the
welcome center.

After installation on any platform, the welcome window announces success and
presents three large buttons:

* **Open Browser Version** – opens the local `index.html` bundled with Pyodide.
* **Open Desktop App** – launches Bio Speak Studio.
* **Open Terminal Version** – starts the `biospeak` REPL in a new shell.

Every edition uses the same `biospeak_core` package, keeping results identical
across web, desktop, and terminal workflows.
